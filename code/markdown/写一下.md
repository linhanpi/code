# Tenzing and Necklace 题解

## 题意

你需要把一个环切成若干部分，切断一个位置需要花费一定的时间，查询最少时间满足每个部分的大小 $\leq k$。

## 题解

添加一个限制：“必须删掉 $m$ 条边”。

考虑从小到大枚举最小的割边，

设枚举的最小的割边是 $a_1$，接下来的最优方案是 $a_2,a_3,...,a_m$。

如果再枚举一个最小的割边：$b_1$，之后的最优方案是 $b_2,b_3,...,b_m$。

假设 $a_i<a_{i+1},b_i<b_{i+1},b_1>a_1$。

### 1.可以只调整 $b_2,b_3,...,b_m$，满足 $\forall_{1\leq i\leq m} b_i\geq a_i$，同时调整后的总花费不变。

调整方式如下：

找到最小的 $i$ 满足 $b_i<a_i$，找到 $i$ 后第一个 $j$ 满足 $b_j\geq a_j$，若不存在则令 $j=m+1$。

可以发现可以将 $(b_i,b_{i+1},b_{i+2},...,b_{j-1})$ 替换成 $(a_i,a_{i+1},a_{i+2},...,a_{j-1})$，任然是合法方案，同时将 $(a_i,a_{i+1},a_{i+2},...,a_{j-1})$ 替换成 $(b_i,b_{i+1},b_{i+2},...,b_{j-1})$ 也是合法方案，因为 $b_{i-1}\geq a_{i-1},b_j\geq a_j$。

由于 $a$ 和 $b$ 都是固定 $a_1,b_1$ 的最优方案，所以 $w_{b_i}+w_{b_{i+1}}+...+w_{b_{j-1}}=w_{a_i}+w_{a_{i+1}}+...+w_{a_{j-1}}$，因此将 $(b_i,b_{i+1},b_{i+2},...,b_{j-1})$ 替换成 $(a_i,a_{i+1},a_{i+2},...,a_{j-1})$ 总花费不变。

一直进行上述调整直到不存在 $b_i<a_i$。

同理可证可以只调整 $a_2,a_3,...,a_m$，满足 $\forall_{1\leq i\leq m} b_i\geq a_i$，同时调整后的总花费不变

### 2.若已满足 $\forall_{1\leq i\leq m} b_i\geq a_i$，则可以只调整 $b_2,b_3,...,b_m$，满足 $\forall_{1\leq i<m}a_i\leq b_i\leq a_{i+1}$，同时调整后的总花费不变。假设$a_1<b_1\leq a_2$。

调整方式如下：

找到最小的 $i$ 满足 $b_i> a_{i+1}$，找到 $i$ 后第一个 $j$ 满足 $b_j\leq a_{j+1}$，不妨设 $a_{m+1}=+\infty$。

可以发现可以将 $(b_i,b_{i+1},b_{i+2},...,b_{j-1})$ 替换成 $(a_{i+1},a_{i+2},a_{i+3},...,a_{j})$，任然是合法方案，同时将 $(a_{i+1},a_{i+2},a_{i+3},...,a_{j})$ 替换成 $(b_i,b_{i+1},b_{i+2},...,b_{j-1})$ 也是合法方案，因为 $b_{i-1}\leq a_{i},b_j\leq a_{j+1}$。

由于 $a$ 和 $b$ 都是固定 $a_1,b_1$ 的最优方案，所以 $w_{b_i}+w_{b_{i+1}}+...+w_{b_{j-1}}=w_{a_{i+1}}+w_{a_{i+2}}+...+w_{a_j}$，因此将 $(b_i,b_{i+1},b_{i+2},...,b_{j-1})$ 替换成 $(a_{i+1},a_{i+2},a_{i+3},...,a_{j})$ 总花费不变。

同理可证可以只调整 $a_2,a_3,...,a_m$，满足 $\forall_{1\leq i<m}a_i\leq b_i\leq a_{i+1}$，同时调整后的总花费不变。

### 3.若 $b_1> a_2$，则可以调整 $b_1,b_2,...,b_m$，满足 $b_1\leq a_2$，且总花费不会变大

调整方式如下：

找到最小的 $j$ 满足 $b_j\leq a_{j+1}$，不妨设 $a_{m+1}=+\infty$。

可以发现可以将 $(a_{2},a_{3},a_{4},...,a_{j})$ 替换成 $(b_1,b_{2},b_{3},...,b_{j-1})$，任然是合法方案，同时将 $(b_1,b_{2},b_{3},...,b_{j-1})$ 替换成 $(a_{2},a_{3},a_{4},...,a_{j})$ 也是合法方案，因为 $b_j\leq a_{j+1}$。

由于 $a$ 是固定 $a_1$ 的最优方案，所以 $w_{b_1}+w_{b_{2}}+...+w_{b_{j-1}}\geq w_{a_{2}}+w_{a_{3}}+...+w_{a_j}$，因此将 $(b_1,b_{2},b_{3},...,b_{j-1})$ 替换成 $(a_{2},a_{3},a_{4},...,a_{j})$ 总花费不会变大。

---

结合以上结论，我们可以得到一个必须割掉 $m$ 条边的做法：

令 $a_1=1$，找到一组最优解 $a_1,a_2,a_3,...,a_m$。

之后可以假设，所有的 $b_i$ 都满足，$a_i\leq b_i\leq a_{i+1}$。

得到一个分治的做法，令 $solve((l_1,r_1),(l_2,r_2),(l_3,r_3),...,(l_m,r_m))$ 表示当前需要算出所有 $l_i\leq b_i\leq r_i$ 的最优解。

若 $l_1>r_1$ 则结束，否则令 $x=\lfloor\frac{l_1+r_1}{2}\rfloor$，可以在 $O(\sum r_i-l_i+1)$ 的复杂度内使用 $dp$ 算出 $b_1=x$ 的答案与方案，递归计算 $solve((l_1,b_1-1),(l_2,b_2),(l_3,b_3),...,(l_m,b_m))$ 和 $solve((b_1+1,r_1),(b_2,r_2),(b_3,r_3),...,(b_m,r_m))$。

时间复杂度分析：$\sum r_i-l_i+1=(\sum r_i-l_i)+m$。如果相邻两个部分的总和 $\leq k$，则可以合并，一定不是最优方案，所以不妨设 $m\leq 2\lceil\frac{n}{k}\rceil$。假设第一段的长度是 $r_1-l_1+1=O(k)$，时间复杂度为 $O(n\log k+mk)=O(n\log k)$。

接下来我们需要对于所有可能的 $m$ 算出答案，取 $\min$就是最终的答案。

割去第一条边后如果最优方案需要割掉 $m'$ 条边，与之前的证明类似，可以调整全局最优方案，使得 $|m-m'|\leq 1$ 且总代价不会变大。